<!DOCTYPE HTML>
<html>

<head>
    <style>
    </style>
    <!-- standard flatbuffers js API -->
    <script src="flatbuffers.js"></script>
    <!-- generated by flatbuffers flatc-command, from messages.fbs -->
    <script src="messages_generated.js"></script>
    <!-- our websockets messaging framework -->
    <script src="messages.js"></script>
    <script>


        function ping(msg) {
            m.builder.clear();
            m.builder.finish(
                event.Message.createMessage(
                    m.builder,
                    event.EventUnion.Echo,
                    event.createEcho(
                        m.builder,
                        123,
                        456,
                        m.builder.createString("payload")
                    )
                )
            );
            m.send();
        }


        function join(id) {
            m.builder.finish(
                event.Message.createMessage(
                    m.builder,
                    event.EventUnion.Join,
                    event.Join.createJoin(
                        m.builder,
                        m.builder.createString(id)
                    ),
                )
            );
            m.send(m.builder);

        }

        m.start(function()
        {
            join("geeert");
        });

        // m.handlers[event.EventUnion.Echo] = function (msg) {
        //     // console.log(msg);
        //     ping();
        // }


        m.handlers[event.EventUnion.Error] = function (msg) {
            error = msg.event(new event.Error());
            console.error("Server reports error: " + error.description());
        }



    </script>

</head>

<body>

    <h1>Stats</h1>
    <pre id='stats'></pre>


    <button onclick='join("geert"); '>join</button>
    <button onclick='addping(1000);'>Add 1000 pings</button>

    <h1>Log</h1>
    <div id='log'></div>

</body>

</html>