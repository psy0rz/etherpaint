<!DOCTYPE html>
<html class="has-navbar-fixed-top">

<head>
    <meta charset="utf-8">
    <!--    <meta name="viewport" content="width=device-width, initial-scale=1">-->
    <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1">

    <!-- external frameworks -->
    <script src="https://cdn.jsdelivr.net/npm/@svgdotjs/svg.js@3.0/dist/svg.min.js"></script>
    <!--    <link rel="stylesheet" href="https://unpkg.com/onsenui/css/onsenui.css">-->
    <!--    <link rel="stylesheet" href="https://unpkg.com/onsenui/css/onsen-css-components.min.css">-->
    <!--    <script src="https://unpkg.com/onsenui/js/onsenui.min.js"></script>-->
    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.0/css/bulma.min.css">


    <script src="https://hammerjs.github.io/dist/hammer.min.js"></script>


    <!-- standard flatbuffers js API -->
    <script src="flatbuffers.js"></script>
    <!-- generated by flatbuffers flatc-command, from messages.fbs -->
    <script src="messages_generated.js"></script>
    <!-- our websockets messaging framework -->
    <script src="messages.js"></script>

    <!-- paper app stuff -->
    <script src="control.js"></script>
    <script src="paper.js"></script>
    <script src="paperClient.js"></script>

    <style>
        .selected {
            stroke: blue;
            stroke-dasharray: 10 5 1 5;
        }


    </style>


    <script>


        function toggleMenu() {
            document.querySelector('#toolmenu').classList.toggle('is-active');
            document.querySelector('.navbar-burger').classList.toggle('is-active');

        }

        window.addEventListener('load', (event) => {

            //move toolbar tools around according to screen width
            new ResizeObserver(function () {
                const burger = document.querySelector("#mainbar .burger");
                for (const e of document.querySelectorAll("#mainbar .control")) {
                    // e.classList.remove("is-hidden");
                    // console.log(e.offsetLeft+e.offsetWidth, document.querySelector("#mainbar").offsetWidth);
                }


                var nodesArray = Array.prototype.slice.call(document.querySelectorAll("#mainbar .control"));
                for (const e of nodesArray.reverse()) {
                    e.classList.remove("is-hidden");
                    const right = e.offsetLeft + e.offsetWidth;
                    if (right > document.querySelector("#mainbar").offsetWidth - 10) {

                        // e.classList.add("is-hidden");

                    }
                    // console.log(e.offsetLeft+e.offsetWidth, document.querySelector("#mainbar").offsetWidth);
                }


            }).observe(document.querySelector("#mainbar"));

            // controlHamburgers();
            document.querySelector(".navbar-burger").addEventListener('click', () => {
                toggleMenu();
            });

            //make sure paper starts after toolbar
            document.querySelector('#paper-container').style.top = document.querySelector("nav").offsetHeight + "px";


            paper.start(
                document.querySelector('#viewer'),
                document.querySelector('#paper'),
                document.querySelector("#scratch"),
                document.querySelector("#paper-container"));
            control.start();

            //start websocket messaging:
            m.start(function () {
                //(re)-connected
                paper.join(document.location.search);


            });

        })


    </script>


</head>
<body>


<nav id="mainbar" role="navigation" aria-label="main navigation" class="navbar is-fixed-top">
    <div class="navbar-brand ">

        <div class="navbar-item">
            <div class="field is-grouped " id="tools">
                <p class="control" id="debug" style="font-size: 80%">0.2alpha</p>
                <p class="control">
                    <a class="button is-primary" onclick="control.onClickToolPointer(this)">
                        <span class="icon">
                            <i class="fas fa-hand-point-up" aria-hidden="true"></i>
                        </span>
                    </a>
                    <a class="button" onclick="control.onClickToolPolyline(this)">
                        <span class="icon">
                            <i class="fas fa-pen" aria-hidden="true"></i>
                        </span>
                    </a>
                    <!--                    <a class="button" onclick="control.onClickToolCircle(this)">-->
                    <!--                        <span class="icon">-->
                    <!--                            <i class="far fa-circle" aria-hidden="true"></i>-->
                    <!--                        </span>-->
                    <!--                    </a>-->
                    <a class="button" onclick="control.onClickToolRect(this)">
                        <span class="icon">
                            <i class="far fa-square" aria-hidden="true"></i>
                        </span>
                    </a>
                    <a class="button" onclick="control.onClickToolDelete(this)">
                        <span class="icon">
                            <i class="fas fa-eraser" aria-hidden="true"></i>
                        </span>
                    </a>
                </p>

                <!--                <p class="control 		">-->
                <!--                    <a class="button" onclick="control.onClickUndo(this)">-->
                <!--                        <span class="icon">-->
                <!--                            <i class="fas fa-undo" aria-hidden="true"></i>-->
                <!--                        </span>-->
                <!--                    </a>-->
                <!--                    <a class="button" onclick="control.onClickRedo(this)">-->
                <!--                        <span class="icon">-->
                <!--                            <i class="fas fa-redo" aria-hidden="true"></i>-->
                <!--                        </span>-->
                <!--                    </a>-->
                <!--                </p>-->

                <p class="control">
                    <a class="button" onclick="control.onClickZoomOut(this)">
                        <span class="icon">
                            <i class="fas fa-search-minus" aria-hidden="true"></i>
                        </span>
                    </a>
                    <a class="button" onclick="control.onClickZoomIn(this)">
                        <span class="icon">
                            <i class="fas fa-search-plus" aria-hidden="true"></i>
                        </span>
                    </a>


                </p>

                <p class="control">
                    <a class="button" onclick="control.onClickHistory(this);toggleMenu()">
                        <span class="icon">
                            <i class="fas fa-history" aria-hidden="true"></i>
                        </span>
                    </a>
                </p>

            </div>
        </div>

        <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
    </div>


    <div id="toolmenu" class="navbar-menu">
        <div class="navbar-end">
            <div class="navbar-item">

            </div>
        </div>
    </div>
</nav>

<!--History slider-->
<nav role="navigation" id="history" class="navbar is-fixed-top is-hidden">
    <div class="navbar-brand ">
        <div class="navbar-item">
            <div class="field is-grouped">

                <p class="control">
                    <a class="button" onclick="control.onClickHistoryClose(this)">
                        <span class="icon">
                            <i class="fas fa-window-close" aria-hidden="true"></i>
                        </span>
                    </a>
                </p>
                <p class="control" style="width: 500px">
                    <input id="history-slider" style='width: 100%' type="range" min="0"
                           max="1000" oninput="control.onInputHistory(this)">
                </p>

            </div>

        </div>
</nav>


<!--<section class="section">-->
<!--    <div class="container">-->

<!-- Your page content here. -->
<div id="paper-container" style="
    position:fixed;
    top:0;
    left:0 ;
    right:0;
    bottom:0 ;
    overflow: auto;
user-select: none;
padding: 0px;
margin: 0px;

">

    <!-- viewer, handles mouseevents, zooming and panning -->
    <svg id="viewer"
         style="
                position: absolute;
                left: 0;
                right:0;
                overflow:hidden;
    touch-action: none;
      /*scroll-behavior:            auto;*/
/*overflow-scrolling: touch;*/

user-select: none;
border-style: solid;
border-color: #aaaaaa;
border-width: 5px;
padding: 0px;
margin: 0px;
width:10000px;
height:10000px;

                    ">

        <!-- grid background -->
        <svg style="pointer-events: none;">
            <!-- the grid-->
            <defs>
                <pattern id="grid-pattern" width="250" height="250" patternUnits="userSpaceOnUse">
                    <path d="M 0 50 L 250 50 M 50 0 L 50 250 M 0 100 L 250 100 M 100 0 L 100 250 M 0 150 L 250 150 M 150 0 L 150 250 M 0 200 L 250 200 M 200 0 L 200 250"
                          fill="none" stroke="#eeeeee" stroke-width="1"></path>
                    <path d="M 250 0 L 0 0 0 250" fill="none" stroke="#aaaaaa" stroke-width="1"></path>
                </pattern>
            </defs>
            <rect width="100%" height="100%" fill="url(#grid-pattern)"></rect>

            <!-- left upper "fold"-->
            <path d="M 0 0 L45 0 L0 45 "></path>
            <path d="M 0 0 L45 0 L0 45 " fill="#aaaaaa"></path>
            <path d="M 0 45 L45 45 L45 0" stroke="#444444" fill="none"></path>
        </svg>


        <!-- actual paper -->
        <svg id="paper" style="color-rendering: optimizeSpeed; ">
        </svg>

        <!-- scratch buffer for cursors and objects-in-action -->
        <svg id="scratch" style="pointer-events: none;">
        </svg>

    </svg>

</div>

<!--    </div>-->
<!--</section>-->


</body>

</html>