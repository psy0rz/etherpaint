<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <!--    <meta name="viewport" content="width=device-width, initial-scale=1">-->
    <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1">

    <!-- external frameworks -->

    <script src="./node_modules/jquery/dist/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="./node_modules/fomantic-ui-css/semantic.min.css">
    <script src="./node_modules/fomantic-ui-css/semantic.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/@svgdotjs/svg.js@3.0/dist/svg.min.js"></script>
    <!--    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>-->
    <!--    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.0/css/bulma.min.css">-->


<!--    <script src="https://hammerjs.github.io/dist/hammer.min.js"></script>-->


    <!-- standard flatbuffers js API -->
    <script src="flatbuffers.js"></script>
    <!-- generated by flatbuffers flatc-command, from messages.fbs -->
<!--    <script src="messages_generated.js"></script>-->
    <!-- our websockets messaging framework -->
<!--    <script src="messages.js"></script>-->

    <!-- paper app stuff -->
<!--    <script src="control.js"></script>-->
<!--    <script src="paper.js" type="module"></script>-->
<!--    <script src="paperClient.js"></script>-->
<!--    <script src="test.js"></script>-->

    <style>
        .selected {
            stroke: blue;
            stroke-dasharray: 10 5 1 5;
        }


    </style>
  

    <script type="module">


        import { m } from "./messages.js";
        import PaperDraw from "./paperDraw.js";
        import PaperSend from "./paperSend.js";
        import PaperReceive from "./paperReceive.js";
        import ControlDrawing from "./controlDrawing.js";

        // function toggleMenu() {
        //     document.querySelector('#toolmenu').classList.toggle('is-active');
        //     document.querySelector('.navbar-burger').classList.toggle('is-active');
        //
        // }

        window.addEventListener('load', (event) => {



            let paperDraw=new PaperDraw(
                document.querySelector("#paper"),
                document.querySelector("#scratch")
            );

            let paperSend=new PaperSend(m);

            let paperReceive=new PaperReceive(m, paperDraw, paperSend);

            let controlDrawing = new ControlDrawing(paperSend);



            // //start websocket messaging:
            m.start(function () {
                //(re)-connected
                paperSend.join(document.location.search);
                paperSend.send();
            });




            function toggleFullScreen() {
                var doc = window.document;
                var docEl = doc.documentElement;

                var requestFullScreen = docEl.requestFullscreen || docEl.mozRequestFullScreen || docEl.webkitRequestFullScreen || docEl.msRequestFullscreen;
                var cancelFullScreen = doc.exitFullscreen || doc.mozCancelFullScreen || doc.webkitExitFullscreen || doc.msExitFullscreen;

                if (!doc.fullscreenElement && !doc.mozFullScreenElement && !doc.webkitFullscreenElement && !doc.msFullscreenElement) {
                    requestFullScreen.call(docEl);
                } else {
                    // cancelFullScreen.call(doc);
                }
            }

            // $('#paper-container').on('click', function() {
            //     console.log("GA");
            //     toggleFullScreen();
            // });
            window.scrollTo(0, 1);

            let hidable_values = [];
            let skipped = false;
            $('.hidable-tool').each(function () {
                if (!skipped)
                    skipped = true
                else
                    $(this).hide();

                hidable_values.push({
                    name: this.title,
                    value: this.id,
                    icon: $("i", this)[0].className
                })
            })

            $('.ui.dropdown')
                .dropdown(
                    {
                        onChange: function (value, text, $choice) {

                            $(".hidable-tool").hide();
                            $("#" + value).addClass("active").show();
                            $("#" + value).trigger('click');

                            // $('.ui.dropdown').dropdown('hide');
                        },
                        values: hidable_values
                    }
                );


            //move toolbar tools around according to screen width
            // new ResizeObserver(function () {
            //     const burger = document.querySelector("#mainbar .burger");
            //     for (const e of document.querySelectorAll("#mainbar .control")) {
            //         // e.classList.remove("is-hidden");
            //         // console.log(e.offsetLeft+e.offsetWidth, document.querySelector("#mainbar").offsetWidth);
            //     }
            //
            //
            //     var nodesArray = Array.prototype.slice.call(document.querySelectorAll("#mainbar .control"));
            //     for (const e of nodesArray.reverse()) {
            //         e.classList.remove("is-hidden");
            //         const right = e.offsetLeft + e.offsetWidth;
            //         if (right > document.querySelector("#mainbar").offsetWidth - 10) {
            //
            //             // e.classList.add("is-hidden");
            //
            //         }
            //         // console.log(e.offsetLeft+e.offsetWidth, document.querySelector("#mainbar").offsetWidth);
            //     }
            //
            //
            // }).observe(document.querySelector("#mainbar"));

            // // controlHamburgers();
            // document.querySelector(".navbar-burger").addEventListener('click', () => {
            //     toggleMenu();
            // });

            //make sure paper starts after toolbar
            document.querySelector('#paper-container').style.top = document.querySelector("#topbar").offsetHeight + "px";


            //
            //
            // });

        })


    </script>


</head>
<body style="overflow: hidden">

<div id="topbar" class="ui top fixed menu">
    <div class="item">
        <div class="ui icon buttons tools">
            <div class="ui button onClick tool polyline"><i class="pen icon"></i></div>

            <div class="ui button onClick tool delete"><i class="eraser icon"></i></div>

            <div class="ui button hidable-tool onClick tool pointer" id="tool-pointer" title="Pointer"><i
                    class="mouse pointer icon"></i>
            </div>
            <div class="ui button hidable-tool onClick tool rect" id="tool-rectangle" title="Rectangle"><i
                    class="square outline icon"></i></div>

            <div class="ui button hidable-tool onClick tool circle" id="tool-circle" title="Circle"><i class="circle outline icon"></i>
            </div>
            <div class="ui button hidable-tool" id="tool-image" title='Image'><i class="image icon"></i></div>

            <div class="ui icon dropdown button">
                <i class="dropdown icon"></i>

            </div>


        </div>
        <div class="ui icon buttons">

            <div class="ui button"><i class="undo icon"></i></div>
            <div class="ui button"><i class="redo icon"></i></div>
            <!--            <div class="ui button"><i class="history icon"></i></div>-->

        </div>
        <div class="ui basic icon button">
            <svg style="width:20px; height:10px">
                <path d="M 0 5 L20 5 " stroke="#ff0000" stroke-width="2px"></path>

            </svg>

        </div>
        <!--                        <div class="ui button"><i class="zoom out icon"></i></div>-->

        <!--        <div class="ui icon buttons">-->
        <!--                        <div class="ui button"><i class="zoom out icon"></i></div>-->
        <!--                        <div class="ui  button"><i class="zoom in icon"></i></div>-->

        <!--        </div>-->

<!--        <div class="ui icon buttons">-->
<!--            <div class="ui button" onclick="test.startRecord()"><i class="record icon"></i></div>-->
<!--            <div class="ui button" onclick="test.stop()"><i class="stop icon"></i></div>-->
<!--            <div class="ui button" onclick="test.startPlayback()"><i class="play icon"></i></div>-->
<!--        </div>-->
    </div>
</div>

<!--<div class="ui left fixed vertical menu compact">-->
<!--    <div class="vertical item">-->
<!--        <div class="ui icon vertical buttons">-->
<!--            <div class="ui button "><i class="hand point up icon"></i></div>-->
<!--            <div class="ui button"><i class="pen icon"></i></div>-->
<!--            <div class="ui button"><i class="square outline icon"></i></div>-->
<!--            <div class="ui button"><i class="circle outline icon"></i></div>-->
<!--            <div class="ui button"><i class="circle eraser icon"></i></div>-->
<!--        </div>-->
<!--    </div>-->
<!--    <div class="vertical item">-->
<!--        <div class="ui icon vertical buttons">-->
<!--            <div class="ui button "><i class="hand point up icon"></i></div>-->
<!--            <div class="ui button"><i class="pen icon"></i></div>-->
<!--            <div class="ui button"><i class="square outline icon"></i></div>-->
<!--            <div class="ui button"><i class="circle outline icon"></i></div>-->
<!--            <div class="ui button"><i class="circle eraser icon"></i></div>-->
<!--        </div>-->
<!--    </div>-->
<!--</div>-->

<!--<div class="ui bottom fixed menu">-->
<!--    <div class="item">-->

<!--        <div class="ui icon buttons">-->
<!--            <div class="ui button"><i class="undo icon"></i></div>-->
<!--            <div class="ui button"><i class="redo icon"></i></div>-->
<!--            <div class="ui button"><i class="history icon"></i></div>-->
<!--        </div>-->
<!--    </div>-->
<!--    <div class="item">-->
<!--        <div class="ui icon  buttons">-->
<!--            <div class="ui button"><i class="zoom out icon"></i></div>-->
<!--            <div class="ui  button"><i class="zoom in icon"></i></div>-->

<!--        </div>-->
<!--        <div class="top floating ui label">100%</div>-->
<!--    </div>-->
<!--</div>-->


<!--<section class="section">-->
<!--    <div class="container">-->

<!-- Your page content here. -->
<div id="paper-container" style="
    position:absolute;
    top:0;
    left:0;
    right:0;
    bottom:0 ;
    overflow: auto;
    user-select: none;
    padding: 0px;
    margin: 0px;
">



    <!-- viewer, handles mouseevents, zooming and panning -->
    <svg id="viewer"
         style="
                /*position: absolute;*/
                /*left: 0;*/
                /*right:0;*/
                overflow:hidden;
    touch-action: none;
      /*scroll-behavior:            auto;*/
/*overflow-scrolling: touch;*/

user-select: none;
border-style: solid;
border-color: #aaaaaa;
border-width: 5px;
padding: 0px;
margin: 0px;
width:10000px;
height:10000px;

                    ">

        <!-- grid background -->
        <svg style="pointer-events: none;">
            <!-- the grid-->
            <defs>
                <pattern id="grid-pattern" width="250" height="250" patternUnits="userSpaceOnUse">
                    <path d="M 0 50 L 250 50 M 50 0 L 50 250 M 0 100 L 250 100 M 100 0 L 100 250 M 0 150 L 250 150 M 150 0 L 150 250 M 0 200 L 250 200 M 200 0 L 200 250"
                          fill="none" stroke="#eeeeee" stroke-width="1"></path>
                    <path d="M 250 0 L 0 0 0 250" fill="none" stroke="#aaaaaa" stroke-width="1"></path>
                </pattern>
            </defs>
            <rect width="100%" height="100%" fill="url(#grid-pattern)"></rect>

            <!-- left upper "fold"-->
            <path d="M 0 0 L45 0 L0 45 "></path>
            <path d="M 0 0 L45 0 L0 45 " fill="#aaaaaa"></path>
            <path d="M 0 45 L45 45 L45 0" stroke="#444444" fill="none"></path>
        </svg>


        <!-- actual paper -->
        <svg id="paper" style="color-rendering: optimizeSpeed; ">
        </svg>

        <!-- scratch buffer for cursors and objects-in-action -->
        <svg id="scratch" style="pointer-events: none;">
        </svg>

    </svg>

</div>

<!--    </div>-->
<!--</section>-->


</body>

</html>