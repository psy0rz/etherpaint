<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <!--    <meta name="viewport" content="width=device-width, initial-scale=1">-->
    <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1">

    <!-- external frameworks -->

    <script src="/node_modules/jquery/dist/jquery.min.js"></script>

    <!--    TODO: smaller, include external fonts-->
    <link rel="stylesheet" type="text/css" href="/node_modules/fomantic-ui-css/semantic.min.css">
    <link rel="stylesheet" type="text/css" href="/paper.css">
    <script src="/node_modules/fomantic-ui-css/semantic.min.js"></script>

    <!-- TODO: add to node modules-->
    <script src="https://cdn.jsdelivr.net/npm/@svgdotjs/svg.js@3.0/dist/svg.min.js"></script>


    <!-- standard flatbuffers js API -->
    <script src="/flatbuffers.js"></script>

    <style>

        svg * {
            text-rendering: optimizeSpeed;
            color-rendering: optimizeSpeed;
            /*shape-rendering: optimizeSpeed;*/
            /*stroke-linecap: round;*/


        }

        /*performance*/
        #scratch > * {
            pointer-events: none;
        }

        #paper > * {
            pointer-events: none;
        }

        /*this will automatcily get assigned classes according to selected attributes*/
        .paper-attribute-pallet svg {
            width: 22px;
            height: 22px;
            padding: 0px;
            margin: 0;
            border: 1px solid #eeeeee;

        }

        /*we need more width to properly show the dashing pattern*/
        .paper-select-dashing svg {
            width: 44px;
        }

        /*scale to 0.5, since this is the default scale of the drawing*/
        .paper-attribute-pallet path {
            transform: scale(0.5);
        }

        .paper-attribute-pallet .selected > svg {
            border: 1px solid #000000;

        }

        .draw-disabled {
            pointer-events: none;
        }

        /*.busy {*/
        /*    cursor: wait;*/
        /*}*/

        .cursor-text
        {
            stroke-width: 1px;
            font-size: 30px;
            stroke: black;
            fill: black;
            text-anchor: middle;


        }

    </style>


    <script type="module">


        import {m} from "/messages.js?123";
        import PaperDraw from "/paperDraw.js";
        import PaperSend from "/paperSend.js";
        import PaperReceive from "/paperReceive.js";
        import ControlDrawing from "/controlDrawing.js";
        import ControlUI from "/controlUI.js";


        window.addEventListener('load', (event) => {

            let paperDraw = new PaperDraw(
                document.querySelector("#paper"),
                document.querySelector("#scratch")
            );

            let paperSend = new PaperSend(m);

            let paperReceive = new PaperReceive(m, paperDraw, paperSend);
            paperSend.paperReceive = paperReceive;

            let controlUI = new ControlUI(m);
            let controlDrawing = new ControlDrawing(paperSend);



            // //start websocket messaging:
            m.start();

            //XXX
            // $(".paper-attribute-pallet").click();

        })


    </script>


</head>
<body style="
/*overflow: hidden*/
">

<div id="topbar" class="ui top fixed menu">
    <span id="debug"></span>
    <div id="draw-toolbar" class="item">
        <div class="ui icon buttons tools ">

            <!--            color/attribute popup button-->
            <div class="ui basic button paper-attribute-dropdown paper-attribute-pallet paper-defaults"
                 style="padding:2px; height:36px;  width:36px;">

                <svg class="paper-attribute-preview" style="width: 33px; height: 33px; border: none">
                    <path d="M 0 0 L100 100 "></path>
                </svg>

                <div class="ui fluid  menu popup transition hidden  ">
                    <div class="ui grid">

                        <div class="item float right">
                            <i class="icon close"></i>
                        </div>

                        <div class="row  paper-select-color" style="padding:0">
                            <!--                            RYB main colors-->
                            <a class="c1 w32 paper-click ">
                                <svg class="">
                                    <path d="M 0 0 L0 30 L30 30 L30 0 "></path>
                                </svg>
                            </a>
                            <a class="c2 w32 paper-click">
                                <svg>
                                    <path d="M 0 0 L0 30 L30 30 L30 0 "></path>
                                </svg>
                            </a>
                            <a class="c3 w32 paper-click">
                                <svg>
                                    <path d="M 0 0 L0 30 L30 30 L30 0 "></path>
                                </svg>
                            </a>
                            <a class="c4 w32 paper-click">
                                <svg>
                                    <path d="M 0 0 L0 30 L30 30 L30 0 "></path>
                                </svg>
                            </a>
                            <a class="c5 w32 paper-click">
                                <svg>
                                    <path d="M 0 0 L0 30 L30 30 L30 0 "></path>
                                </svg>
                            </a>
                            <a class="c6 w32 paper-click">
                                <svg>
                                    <path d="M 0 0 L0 30 L30 30 L30 0 "></path>
                                </svg>
                            </a>
                            <a class="c7 w32 paper-click">
                                <svg>
                                    <path d="M 0 0 L0 30 L30 30 L30 0 "></path>
                                </svg>
                            </a>
                            <a class="c8 w32 paper-click">
                                <svg>
                                    <path d="M 0 0 L0 30 L30 30 L30 0 "></path>
                                </svg>
                            </a>
                            <a class="c9 w32 paper-click">
                                <svg>
                                    <path d="M 0 0 L0 30 L30 30 L30 0 "></path>
                                </svg>
                            </a>
                            <a class="c10 w32 paper-click">
                                <svg>
                                    <path d="M 0 0 L0 30 L30 30 L30 0 "></path>
                                </svg>
                            </a>
                            <a class="c11 w32 paper-click">
                                <svg>
                                    <path d="M 0 0 L0 30 L30 30 L30 0 "></path>
                                </svg>
                            </a>
                            <a class="c12 w32 paper-click">
                                <svg>
                                    <path d="M 0 0 L0 30 L30 30 L30 0 "></path>
                                </svg>
                            </a>
                        </div>

                        <div class="row  paper-select-color" style="padding:0">
                            <!--                            black/gray/white-->
                            <a class="c0 w32  paper-click">
                                <svg>
                                    <path d="M 0 0 L0 30 L30 30 L30 0 "></path>
                                </svg>
                            </a>
                            <a class="c100 w32 paper-click">
                                <svg>
                                    <path d="M 0 0 L0 30 L30 30 L30 0 "></path>
                                </svg>
                            </a>
                            <a class="c105 w32  paper-click">
                                <svg>
                                    <path d="M 0 0 L0 30 L30 30 L30 0 "></path>
                                </svg>
                            </a>
                            <a class="c110 w32 paper-click">
                                <svg>
                                    <path d="M 0 0 L0 30 L30 30 L30 0 "></path>
                                </svg>
                            </a>
                            <a class="c255 w32 paper-click">
                                <svg>
                                    <path d="M 0 0 L0 30 L30 30 L30 0 "></path>
                                </svg>
                            </a>

                            <!--                            other common colors-->
                            <a class="c20 w32 paper-click">
                                <svg>
                                    <path d="M 0 0 L0 30 L30 30 L30 0 "></path>
                                </svg>
                            </a>

                        </div>

                        <!--select width-->
                        <div class="row paper-select-width" style="padding:0">
                            <a class="w1 paper-click">
                                <svg>
                                    <path d="M 0 20 L40 20 "></path>
                                </svg>
                            </a>
                            <a class="w2 paper-click">
                                <svg>
                                    <path d="M0 20 L40 20 "></path>
                                </svg>
                            </a>
                            <a class="w4 paper-click">
                                <svg>
                                    <path d="M0 20 L40 20 "></path>
                                </svg>
                            </a>
                            <a class="w8 paper-click">
                                <svg>
                                    <path d="M0 20 L40 20 "></path>
                                </svg>
                            </a>
                            <a class="w12 paper-click">
                                <svg>
                                    <path d="M0 20 L40 20 "></path>
                                </svg>
                            </a>
                            <a class="w16 paper-click">
                                <svg>
                                    <path d="M0 20 L40 20 "></path>
                                </svg>
                            </a>
                            <a class="w20 paper-click">
                                <svg>
                                    <path d="M0 20 L40 20 "></path>
                                </svg>
                            </a>
                            <a class="w24 paper-click">
                                <svg>
                                    <path d="M0 20 L40 20 "></path>
                                </svg>
                            </a>
                            <a class="w32 paper-click">
                                <svg>
                                    <path d="M0 20 L40 20 "></path>
                                </svg>
                            </a>
                            <a class="w64 paper-click">
                                <svg>
                                    <path d="M0 20 L40 20 "></path>
                                </svg>
                            </a>
                            <!--                            <p class="header">-->
                            <!--                                (width)-->
                            <!--                            </p>-->
                        </div>

                        <!--select dashing-->
                        <div class="row paper-select-dashing w4" style="padding:0">
                            <a class="d1  paper-click">
                                <svg>
                                    <path d="M0 15 L90 15 "></path>
                                </svg>
                            </a>
                            <a class="d2 paper-click">
                                <svg>
                                    <path d="M0 25 L90 25 "></path>
                                </svg>
                            </a>
                            <a class="d3 paper-click">
                                <svg>
                                    <path d="M0 15 L90 15 "></path>
                                </svg>
                            </a>
                            <a class="d4 paper-click">
                                <svg>
                                    <path d="M0 25 L90 25 "></path>
                                </svg>
                            </a>
                            <a class="d5 paper-click">
                                <svg>
                                    <path d="M0 15 L90 15 "></path>
                                </svg>
                            </a>
                        </div>


                        <!--                        full line preview-->
                        <div class="row paper-attribute-preview" style="padding:0">
                            <svg style="border: none; width:100%; height:40px">
                                <path d="M 20 20 L600 20 "></path>
                            </svg>
                        </div>


                    </div>
                </div>
            </div>

            <div class="ui button paper-click paper-tool paper-polyline"><i class="pen icon"></i></div>

            <div class="ui button paper-click paper-tool delete"><i class="eraser icon"></i></div>

            <div class="ui button paper-hidable-tool paper-click paper-tool paper-pointer" id="tool-pointer"
                 title="Pointer"><i
                    class="hand pointer icon"></i>
            </div>
            <div class="ui button paper-hidable-tool paper-click paper-tool paper-rect" id="tool-rectangle"
                 title="Rectangle"><i
                    class="square outline icon"></i></div>

            <div class="ui button paper-hidable-tool paper-click paper-tool paper-circle" id="tool-circle"
                 title="Circle"><i class="circle outline icon"></i>
            </div>
            <div class="ui button paper-hidable-tool" id="tool-image" title='Image'><i class="image icon"></i></div>

            <div class="ui icon dropdown button paper-tool-dropdown">
                <i class="dropdown icon"></i>

            </div>

        </div>
        <div class="ui icon buttons">

            <div class="ui button paper-click paper-undo"><i class="undo icon"></i></div>
            <div class="ui button paper-click paper-redo"><i class="redo icon"></i></div>
            <div class="ui button paper-click paper-history"><i class="history icon"></i></div>

        </div>

        <div class="ui label">
            <a href="https://github.com/psy0rz/etherpaint/issues">
            <i class="icon github"></i>v0.4
            </a>
        </div>

        <!--        <div class="ui icon buttons">-->

        <!--            <div class="ui button paper-click paper-tool zoomIn"><i class="search plus icon"></i></div>-->
        <!--            <div class="ui button paper-click paper-tool zoomOut"><i class="search minus icon"></i></div>-->

        <!--        </div>-->

        <!--        <div class="ui icon buttons">-->
        <!--            <div class="ui button" paper-click="test.startRecord()"><i class="record icon"></i></div>-->
        <!--            <div class="ui button" paper-click="test.stop()"><i class="stop icon"></i></div>-->
        <!--            <div class="ui button" paper-click="test.startPlayback()"><i class="play icon"></i></div>-->
        <!--        </div>-->
    </div>



</div>



<div id="paper-container"
     class=""
     style="
        position: absolute;
        left:0;
        right:0;
        top:63;
        bottom:0;
    ">

    <svg id="paper"
         class="paper-defaults"
         style="
            touch-action: none;
            user-select: none;
        position: absolute;
        left:0;
        right:0;
        top:0;
        bottom:0;
                /*user-select: none;*/
                /*pointer-events: none;*/
            ">
    </svg>

    <svg id="scratch"
         class="paper-defaults"

         style="
            touch-action: none;
            user-select: none;
            /*pointer-events: none;*/
        position: absolute;
        left:0;
        right:0;
        top:0;
        bottom:0;
        "></svg>



    <div id="loading-message" class="ui icon floating message">
        <i class="notched circle loading icon"></i>
        <div class="content">
            <div class="header">
                Just one second
            </div>
            <p>Drawing is loading.</p>
        </div>
    </div>

    <div id="disconnected-message" class="ui icon floating error message float">
        <i class="notched circle loading icon"></i>
        <div class="content">
            <div class="header">
                Disconnected
            </div>
            <p>Trying to reconnect.</p>
        </div>
    </div>


</div>
</body>

</html>


<!--    &lt;!&ndash; viewer, handles mouseevents, zooming and panning &ndash;&gt;-->
<!--    <svg id="viewer"-->
<!--         style="-->
<!--                /*position: absolute;*/-->
<!--                /*left: 0;*/-->
<!--                /*right:0;*/-->
<!--                overflow:hidden;-->
<!--    touch-action: none;-->
<!--      /*scroll-behavior:            auto;*/-->
<!--/*overflow-scrolling: touch;*/-->

<!--user-select: none;-->
<!--border-style: solid;-->
<!--border-color: #aaaaaa;-->
<!--border-width: 5px;-->
<!--padding: 0px;-->
<!--margin: 0px;-->
<!--/*width:10000px;*/-->
<!--/*height:10000px;*/-->
<!--                    ">-->

<!--        &lt;!&ndash; grid background &ndash;&gt;-->
<!--        <svg style="pointer-events: none;">-->
<!--            &lt;!&ndash;            &lt;!&ndash; the grid&ndash;&gt;&ndash;&gt;-->
<!--            &lt;!&ndash;            <defs>&ndash;&gt;-->
<!--            &lt;!&ndash;                <pattern id="grid-pattern" width="250" height="250" patternUnits="userSpaceOnUse">&ndash;&gt;-->
<!--            &lt;!&ndash;                    <path d="M 0 50 L 250 50 M 50 0 L 50 250 M 0 100 L 250 100 M 100 0 L 100 250 M 0 150 L 250 150 M 150 0 L 150 250 M 0 200 L 250 200 M 200 0 L 200 250"&ndash;&gt;-->
<!--            &lt;!&ndash;                          fill="none" stroke="#eeeeee" stroke-width="1"></path>&ndash;&gt;-->
<!--            &lt;!&ndash;                    <path d="M 250 0 L 0 0 0 250" fill="none" stroke="#aaaaaa" stroke-width="1"></path>&ndash;&gt;-->
<!--            &lt;!&ndash;                </pattern>&ndash;&gt;-->
<!--            &lt;!&ndash;            </defs>&ndash;&gt;-->
<!--            &lt;!&ndash;            <rect width="100%" height="100%" fill="url(#grid-pattern)"></rect>&ndash;&gt;-->

<!--            &lt;!&ndash; left upper "fold"&ndash;&gt;-->
<!--            <path d="M 0 0 L45 0 L0 45 "></path>-->
<!--            <path d="M 0 0 L45 0 L0 45 " fill="#aaaaaa"></path>-->
<!--            <path d="M 0 45 L45 45 L45 0" stroke="#444444" fill="none"></path>-->
<!--        </svg>-->


<!--        &lt;!&ndash; actual paper &ndash;&gt;-->
<!--        <svg id="paper">-->
<!--        </svg>-->

<!--        &lt;!&ndash; scratch buffer for cursors and objects-in-action &ndash;&gt;-->
<!--        <svg id="scratch" style="pointer-events: none">-->
<!--        </svg>-->

<!--    </svg>-->
