<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <!--    <meta name="viewport" content="width=device-width, initial-scale=1">-->
    <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1">

    <!-- external frameworks -->

    <script src="./node_modules/jquery/dist/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="./node_modules/fomantic-ui-css/semantic.min.css">
    <link rel="stylesheet" type="text/css" href="paper.css">
    <script src="./node_modules/fomantic-ui-css/semantic.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/@svgdotjs/svg.js@3.0/dist/svg.min.js"></script>


    <!-- standard flatbuffers js API -->
    <script src="flatbuffers.js"></script>

    <style>
        /*.selected {*/
        /*    stroke: blue;*/
        /*    stroke-dasharray: 10 5 1 5;*/
        /*}*/


        svg * {
            text-rendering: optimizeSpeed;
            color-rendering: optimizeSpeed;
            /*shape-rendering: optimizeSpeed;*/
        }

        /*performance*/
        #scratch > * {
            pointer-events: none;
        }

        #paper > * {
            pointer-events: none;
        }

        /*this will automatcily get assigned classes according to selected attributes*/
        .paper-attribute-preview svg {
            width: 22px;
            height: 22px;
            padding: 0px;
            margin: 0;
            border: 1px solid #eeeeee;

        }


    </style>


    <script type="module">


        import {m} from "./messages.js";
        import PaperDraw from "./paperDraw.js";
        import PaperSend from "./paperSend.js";
        import PaperReceive from "./paperReceive.js";
        import ControlDrawing from "./controlDrawing.js";
        import ControlUI from "./controlUI.js";


        window.addEventListener('load', (event) => {


            let paperDraw = new PaperDraw(
                document.querySelector("#paper"),
                document.querySelector("#scratch")
            );

            let paperSend = new PaperSend(m);

            let paperReceive = new PaperReceive(m, paperDraw, paperSend);
            paperSend.paperReceive = paperReceive;

            let controlDrawing = new ControlDrawing(paperSend);

            let controlUI = new ControlUI();


            // //start websocket messaging:
            m.start(function () {
                //(re)-connected
                paperSend.join(document.location.search);
                paperSend.send();
            });

            //XXX
            controlDrawing.selectColor("c3");
            controlDrawing.selectWidth("w2");
            $(".paper-click.paper-polyline").click();
            $(".paper-attribute-preview").click();

        })


    </script>


</head>
<body style="
/*overflow: hidden*/
">

<div id="topbar" class="ui top fixed menu">
    <span id="debug"></span>
    <div class="item">
        <div class="ui icon buttons tools ">

            <!--            color/attribute popup button-->
            <div class="ui basic button paper-attribute-dropdown paper-attribute-preview paper-defaults"
                 style="padding:2px; height:36px;  width:36px;">
                <svg>
                    <path d="M 0 0 L30 30 "></path>
                </svg>

                <div class="ui fluid  menu popup transition hidden special ">
                    <div class="ui grid">

                        <div class="item float right">
                            <i class="icon close"></i>
                        </div>

                        <div class="row  paper-select-color" style="padding:0">
                            <a class="c0 w32 paper-click">
                                <svg>
                                    <path d="M 0 0 L30 30 "></path>
                                </svg>
                            </a>
                            <a class="c1 w32 paper-click">
                                <svg class="">
                                    <path d="M 0 0 L30 30 "></path>
                                </svg>
                            </a>
                            <a class="c2 w32 paper-click">
                                <svg>
                                    <path d="M 0 0 L30 30 "></path>
                                </svg>
                            </a>
                            <a class="c3 w32 paper-click">
                                <svg>
                                    <path d="M 0 0 L30 30 "></path>
                                </svg>
                            </a>
                            <a class="c4 w32 paper-click">
                                <svg>
                                    <path d="M 0 0 L30 30 "></path>
                                </svg>
                            </a>
                            <a class="c5 w32 paper-click">
                                <svg>
                                    <path d="M 0 0 L30 30 "></path>
                                </svg>
                            </a>
                            <a class="c6 w32 paper-click">
                                <svg>
                                    <path d="M 0 0 L30 30 "></path>
                                </svg>
                            </a>
                            <a class="c7 w32 paper-click">
                                <svg>
                                    <path d="M 0 0 L30 30 "></path>
                                </svg>
                            </a>
                            <a class="c8 w32 paper-click">
                                <svg>
                                    <path d="M 0 0 L30 30 "></path>
                                </svg>
                            </a>
                            <a class="c9 w32 paper-click">
                                <svg>
                                    <path d="M 0 0 L30 30 "></path>
                                </svg>
                            </a>
                            <a class="c10 w32 paper-click">
                                <svg>
                                    <path d="M 0 0 L30 30 "></path>
                                </svg>
                            </a>
                            <a class="c11 w32 paper-click">
                                <svg>
                                    <path d="M 0 0 L30 30 "></path>
                                </svg>
                            </a>
                            <a class="c12 w32 paper-click">
                                <svg>
                                    <path d="M 0 0 L30 30 "></path>
                                </svg>
                            </a>
                        </div>


                        <div class="row paper-select-width" style="padding:0">
                            <a class="w1 paper-click">
                                <svg>
                                    <path d="M 0 0 L30 30 "></path>
                                </svg>
                            </a>
                            <a class="w2 paper-click">
                                <svg>
                                    <path d="M 0 0 L30 30 "></path>
                                </svg>
                            </a>
                            <a class="w3 paper-click">
                                <svg>
                                    <path d="M 0 0 L30 30 "></path>
                                </svg>
                            </a>
                            <a class="w4 paper-click">
                                <svg>
                                    <path d="M 0 0 L30 30 "></path>
                                </svg>
                            </a>
                            <a class="w8 paper-click">
                                <svg>
                                    <path d="M 0 0 L30 30 "></path>
                                </svg>
                            </a>
                            <a class="w16 paper-click">
                                <svg>
                                    <path d="M 0 0 L30 30 "></path>
                                </svg>
                            </a>
                            <a class="w32 paper-click">
                                <svg>
                                    <path d="M 0 0 L30 30 "></path>
                                </svg>
                            </a>
                        </div>


                    </div>
                </div>
            </div>

            <div class="ui button paper-click paper-tool paper-polyline"><i class="pen icon"></i></div>

            <div class="ui button paper-click paper-tool delete"><i class="eraser icon"></i></div>

            <div class="ui button paper-hidable-tool paper-click paper-tool paper-pointer" id="tool-pointer"
                 title="Pointer"><i
                    class="mouse pointer icon"></i>
            </div>
            <div class="ui button paper-hidable-tool paper-click paper-tool paper-rect" id="tool-rectangle"
                 title="Rectangle"><i
                    class="square outline icon"></i></div>

            <div class="ui button paper-hidable-tool paper-click paper-tool paper-circle" id="tool-circle"
                 title="Circle"><i class="circle outline icon"></i>
            </div>
            <div class="ui button paper-hidable-tool" id="tool-image" title='Image'><i class="image icon"></i></div>

            <div class="ui icon dropdown button paper-tool-dropdown">
                <i class="dropdown icon"></i>

            </div>

        </div>
        <div class="ui icon buttons">

            <div class="ui button paper-click paper-undo"><i class="undo icon"></i></div>
            <div class="ui button paper-click paper-redo"><i class="redo icon"></i></div>
            <div class="ui button paper-click paper-history"><i class="history icon"></i></div>

        </div>
        <!--        <div class="ui icon buttons">-->

        <!--            <div class="ui button paper-click paper-tool zoomIn"><i class="search plus icon"></i></div>-->
        <!--            <div class="ui button paper-click paper-tool zoomOut"><i class="search minus icon"></i></div>-->

        <!--        </div>-->

        <!--        <div class="ui icon buttons">-->
        <!--            <div class="ui button" paper-click="test.startRecord()"><i class="record icon"></i></div>-->
        <!--            <div class="ui button" paper-click="test.stop()"><i class="stop icon"></i></div>-->
        <!--            <div class="ui button" paper-click="test.startPlayback()"><i class="play icon"></i></div>-->
        <!--        </div>-->
    </div>
</div>

<div id="paper-container"
     style="
        position: absolute;
        left:0;
        right:0;
        top:0;
        bottom:0;
    ">

    <svg id="paper"
         class="paper-defaults"
         style="
            touch-action: none;
            user-select: none;
        position: absolute;
        left:0;
        right:0;
        top:0;
        bottom:0;
                /*user-select: none;*/
                /*pointer-events: none;*/
            ">
    </svg>

    <svg id="scratch"
         class="paper-defaults"

         style="
            touch-action: none;
            user-select: none;
            /*pointer-events: none;*/
        position: absolute;
        left:0;
        right:0;
        top:0;
        bottom:0;
        "></svg>

</div>
</body>

</html>


<!--    &lt;!&ndash; viewer, handles mouseevents, zooming and panning &ndash;&gt;-->
<!--    <svg id="viewer"-->
<!--         style="-->
<!--                /*position: absolute;*/-->
<!--                /*left: 0;*/-->
<!--                /*right:0;*/-->
<!--                overflow:hidden;-->
<!--    touch-action: none;-->
<!--      /*scroll-behavior:            auto;*/-->
<!--/*overflow-scrolling: touch;*/-->

<!--user-select: none;-->
<!--border-style: solid;-->
<!--border-color: #aaaaaa;-->
<!--border-width: 5px;-->
<!--padding: 0px;-->
<!--margin: 0px;-->
<!--/*width:10000px;*/-->
<!--/*height:10000px;*/-->
<!--                    ">-->

<!--        &lt;!&ndash; grid background &ndash;&gt;-->
<!--        <svg style="pointer-events: none;">-->
<!--            &lt;!&ndash;            &lt;!&ndash; the grid&ndash;&gt;&ndash;&gt;-->
<!--            &lt;!&ndash;            <defs>&ndash;&gt;-->
<!--            &lt;!&ndash;                <pattern id="grid-pattern" width="250" height="250" patternUnits="userSpaceOnUse">&ndash;&gt;-->
<!--            &lt;!&ndash;                    <path d="M 0 50 L 250 50 M 50 0 L 50 250 M 0 100 L 250 100 M 100 0 L 100 250 M 0 150 L 250 150 M 150 0 L 150 250 M 0 200 L 250 200 M 200 0 L 200 250"&ndash;&gt;-->
<!--            &lt;!&ndash;                          fill="none" stroke="#eeeeee" stroke-width="1"></path>&ndash;&gt;-->
<!--            &lt;!&ndash;                    <path d="M 250 0 L 0 0 0 250" fill="none" stroke="#aaaaaa" stroke-width="1"></path>&ndash;&gt;-->
<!--            &lt;!&ndash;                </pattern>&ndash;&gt;-->
<!--            &lt;!&ndash;            </defs>&ndash;&gt;-->
<!--            &lt;!&ndash;            <rect width="100%" height="100%" fill="url(#grid-pattern)"></rect>&ndash;&gt;-->

<!--            &lt;!&ndash; left upper "fold"&ndash;&gt;-->
<!--            <path d="M 0 0 L45 0 L0 45 "></path>-->
<!--            <path d="M 0 0 L45 0 L0 45 " fill="#aaaaaa"></path>-->
<!--            <path d="M 0 45 L45 45 L45 0" stroke="#444444" fill="none"></path>-->
<!--        </svg>-->


<!--        &lt;!&ndash; actual paper &ndash;&gt;-->
<!--        <svg id="paper">-->
<!--        </svg>-->

<!--        &lt;!&ndash; scratch buffer for cursors and objects-in-action &ndash;&gt;-->
<!--        <svg id="scratch" style="pointer-events: none">-->
<!--        </svg>-->

<!--    </svg>-->
